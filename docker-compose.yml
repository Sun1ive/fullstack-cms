version: '3.3'

services:
  web:
    image: nginx
    restart: always
    volumes:
    - ./nginx/config:/etc/nginx/conf.d
    ports:
    - "80:80"
    depends_on:
    - api
  app:
    image: node:10
    restart: always
    environment:
      - HOST=0.0.0.0
      - PORT=3000
    volumes:
    - ./app:/usr/app
    command: /bin/bash -c "cd /usr/app && npm i && npm run build && npm start"
  api:
    image: node:10
    restart: always
    environment:
      - HOST=0.0.0.0
      - PORT=8081
    volumes:
    - ./api:/usr/api
    command: /bin/bash -c "cd /usr/api && npm i && npm run build && npm start"
